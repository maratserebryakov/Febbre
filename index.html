<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FEBBRE ‚Äî –£—á–∏–º –ø–µ—Ä–µ–≤–æ–¥ –ø–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º (MP4)</title>
  <style>
    :root { color-scheme: dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 18px; background:#0f0f12; color:#eaeaf0; }
    h1 { margin: 0 0 6px; color:#c084fc; font-size: 22px; }
    .hint { margin: 0 0 14px; color:#a1a1aa; line-height: 1.35; }

    .layout { display: grid; grid-template-columns: 1.1fr 1fr; gap: 14px; align-items: start; }
    @media (max-width: 980px){ .layout{ grid-template-columns: 1fr; } }

    .panel { background:#15151b; border:1px solid #2a2a35; border-radius: 14px; padding: 12px; }
    .playerWrap { position: sticky; top: 10px; }
    @media (max-width: 980px){ .playerWrap{ position: static; } }

    video { width: 100%; border-radius: 12px; background:#000; }

    .row { display: grid; grid-template-columns: 1fr; gap: 8px; padding: 12px; border-radius: 12px; background:#111118; border:1px solid #242432; margin-bottom: 10px; }
    .it { font-size: 16px; }
    .ru { display: none; color:#a1a1aa; }

    .controls { display:flex; flex-wrap: wrap; gap:8px; align-items:center; }
    button { border: 0; border-radius: 10px; padding: 8px 10px; cursor: pointer; background:#2d2d3a; color:#eaeaf0; }
    button:hover { filter: brightness(1.07); }
    .primary { background:#7c3aed; }
    .good { background:#10b981; color:#071b12; }
    .warn { background:#f59e0b; color:#1a1204; }
    .bad { background:#ef4444; color:#1f0505; }
    .ghost { background: transparent; border:1px solid #2a2a35; }

    input[type="number"], textarea{
      background:#0f0f12; color:#eaeaf0; border:1px solid #2a2a35; border-radius: 10px;
      padding: 8px 10px;
    }
    input[type="number"]{ width: 96px; }
    textarea { width: 100%; min-height: 110px; resize: vertical; }

    .mini { font-size: 12px; color:#a1a1aa; }
    .topbar { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom: 10px; }
    .chip { display:flex; gap:8px; align-items:center; padding: 10px; border:1px solid #2a2a35; border-radius: 12px; background:#111118; }
    .sep { height: 1px; background:#2a2a35; margin: 12px 0; }
    .muted { opacity:.6; }
    .highlight { box-shadow: 0 0 0 2px #f59e0b inset; }
    .warnText { color:#f59e0b; font-weight:600; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 980px){ .grid2{ grid-template-columns: 1fr; } }
  </style>
</head>

<body>
  <h1>üéµ FEBBRE ‚Äî —É—á–∏–º –ø–µ—Ä–µ–≤–æ–¥ –ø–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º (–ª–æ–∫–∞–ª—å–Ω—ã–π MP4)</h1>
  <p class="hint">
    –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ø–æ–ª–æ–∂–∏ MP4 —Ä—è–¥–æ–º —Å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º –∏ –Ω–∞–∑–æ–≤–∏ <b>febbre.mp4</b> ‚Äî –≤–∏–¥–µ–æ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    –ò–ª–∏ –Ω–∞–∂–º–∏ ¬´–í—ã–±—Ä–∞—Ç—å MP4¬ª. –¢–∞–π–º–∫–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ï—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç JSON.
  </p>

  <div class="layout">
    <div class="panel playerWrap">
      <div class="topbar">
        <div class="chip"><b>–§–∞–π–ª:</b> <span id="fileLabel">febbre.mp4 (–µ—Å–ª–∏ —Ä—è–¥–æ–º)</span></div>
        <div class="chip"><b>–¢–µ–∫—É—â–µ–µ:</b> <span id="now">0.00</span>s</div>
        <button class="ghost" id="copyNow">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ</button>
      </div>

      <div class="topbar">
        <input id="filePick" type="file" accept="video/mp4,audio/mp4,video/*,audio/*" />
        <button class="ghost" id="useDefault">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å febbre.mp4</button>

        <button class="ghost" id="downloadBtn">–°–∫–∞—á–∞—Ç—å</button>
        <span class="mini" id="downloadHint">–§–∞–π–ª –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å —Å –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–∞</span>

        <button class="bad" id="stop">–°—Ç–æ–ø ‚è∏</button>
      </div>

      <video id="vid" controls preload="metadata">
        <source id="defaultSrc" src="febbre.mp4" type="video/mp4" />
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTML5 video.
      </video>

      <div class="sep"></div>

      <div class="topbar">
        <button class="primary" id="saveAll">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë</button>
        <button class="ghost" id="toggleRuAll">–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã</button>
        <button class="ghost" id="toggleLearned">–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –≤—ã—É—á–µ–Ω–Ω—ã–µ</button>
        <button class="bad" id="resetTimes">–°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–∫–æ–¥—ã</button>
      </div>

      <div class="grid2">
        <div>
          <div class="mini" style="margin-bottom:6px;">–≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–π–º–∫–æ–¥–æ–≤ (—Å–∫–æ–ø–∏—Ä—É–π –∫—É–¥–∞-–Ω–∏–±—É–¥—å):</div>
          <textarea id="exportBox" placeholder="–ù–∞–∂–º–∏ ¬´–≠–∫—Å–ø–æ—Ä—Ç¬ª, –ø–æ—è–≤–∏—Ç—Å—è JSON‚Ä¶"></textarea>
          <div class="topbar" style="margin-top:8px;">
            <button class="ghost" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="ghost" id="copyExport">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
          </div>
        </div>
        <div>
          <div class="mini" style="margin-bottom:6px;">–ò–º–ø–æ—Ä—Ç —Ç–∞–π–º–∫–æ–¥–æ–≤ (–≤—Å—Ç–∞–≤—å JSON –∏ –Ω–∞–∂–º–∏ ¬´–ò–º–ø–æ—Ä—Ç¬ª):</div>
          <textarea id="importBox" placeholder='–í—Å—Ç–∞–≤—å JSON —Å—é–¥–∞‚Ä¶'></textarea>
          <div class="topbar" style="margin-top:8px;">
            <button class="ghost" id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
          </div>
        </div>
      </div>

      <div class="mini">
        –°–æ–≤–µ—Ç: start –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –Ω–∞ 0.10‚Äì0.25 —Å–µ–∫ —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª–∞ —Ñ—Ä–∞–∑—ã, end ‚Äî –Ω–∞ 0.10‚Äì0.25 —Å–µ–∫ –ø–æ–∑–∂–µ.
        –§–æ—Ä–º–∞—Ç ‚Äî —Å–µ–∫—É–Ω–¥—ã (–º–æ–∂–Ω–æ –¥—Ä–æ–±–Ω—ã–µ: 42.35).
      </div>
    </div>

    <div class="panel">
      <div id="rows"></div>
    </div>
  </div>

<script>
  const LINES = [
      { it: 'Ti sei preso una parte di me', ru: '–¢—ã –∑–∞–±—Ä–∞–ª —á–∞—Å—Ç—å –º–µ–Ω—è' },
      { it: 'Quella ancora pi√π in fondo dell‚Äôanima', ru: '–¢—É, —á—Ç–æ –µ—â—ë –≥–ª—É–±–∂–µ –≤ –¥—É—à–µ' },
      { it: 'Un sentimento', ru: '–ß—É–≤—Å—Ç–≤–æ' },
      { it: 'Che se si rompe taglia', ru: '–ö–æ—Ç–æ—Ä–æ–µ, –µ—Å–ª–∏ –ª–æ–º–∞–µ—Ç—Å—è, —Ä–µ–∂–µ—Ç' },
      { it: 'Come il vetro', ru: '–ö–∞–∫ —Å—Ç–µ–∫–ª–æ' },
      { it: 'E anche deludere', ru: '–ò –¥–∞–∂–µ —Ä–∞–∑–æ—á–∞—Ä–æ–≤—ã–≤–∞—Ç—å' },
      { it: '√à un‚Äôabitudine', ru: '–≠—Ç–æ –ø—Ä–∏–≤—ã—á–∫–∞' },
      { it: 'Come nel mio primo giorno di scuola', ru: '–ö–∞–∫ –≤ –º–æ–π –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –≤ —à–∫–æ–ª–µ' },
      { it: 'Non so che faccio qui', ru: '–Ø –Ω–µ –∑–Ω–∞—é, —á—Ç–æ –¥–µ–ª–∞—é –∑–¥–µ—Å—å' },
      { it: 'Il buio √® tagliato dalle luci viola', ru: '–¢–µ–º–Ω–æ—Ç–∞ —Ä–∞–∑—Ä–µ–∑–∞–Ω–∞ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–º–∏ –æ–≥–Ω—è–º–∏' },
      { it: 'Il cielo fa come un glitch', ru: '–ù–µ–±–æ –±—É–¥—Ç–æ –≥–ª—é—á–∏—Ç' },
      { it: 'Tu mi guardi dall‚Äôalto', ru: '–¢—ã —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –º–µ–Ω—è —Å–≤–µ—Ä—Ö—É' },
      { it: 'Trascinandomi in basso', ru: '–£—Ç–∞—Å–∫–∏–≤–∞—è –º–µ–Ω—è –≤–Ω–∏–∑' },
      { it: 'Non ascolti quando grido', ru: '–¢—ã –Ω–µ —Å–ª—ã—à–∏—à—å, –∫–æ–≥–¥–∞ —è –∫—Ä–∏—á—É' },
      { it: 'Sembri fatto di ghiaccio', ru: '–¢—ã –±—É–¥—Ç–æ —Å–¥–µ–ª–∞–Ω –∏–∑–æ –ª—å–¥–∞' },
      { it: 'Io sono fatta cos√¨', ru: '–Ø —Ç–∞–∫–∞—è' },
      { it: 'Alle feste chic', ru: '–ù–∞ –≥–ª–∞–º—É—Ä–Ω—ã—Ö –≤–µ—á–µ—Ä–∏–Ω–∫–∞—Ö' },
      { it: 'Sola su un terrazzo', ru: '–û–¥–Ω–∞ –Ω–∞ —Ç–µ—Ä—Ä–∞—Å–µ' },
      { it: 'Tutti fanno bling bling', ru: '–í—Å–µ —Å–≤–µ—Ä–∫–∞—é—Ç' },
      { it: 'Io nemmeno mi piaccio', ru: '–ú–Ω–µ –¥–∞–∂–µ —è —Å–∞–º–∞ –Ω–µ –Ω—Ä–∞–≤–ª—é—Å—å' },
      { it: 'Non dire je t‚Äôaime', ru: '–ù–µ –≥–æ–≤–æ—Ä–∏ ¬´je t‚Äôaime¬ª' },
      { it: 'Dimmelo se', ru: '–°–∫–∞–∂–∏ –º–Ω–µ, –µ—Å–ª–∏' },
      { it: 'Ci√≤ che provi √® solo febbre', ru: '–¢–æ, —á—Ç–æ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å ‚Äî –≤—Å–µ–≥–æ –ª–∏—à—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Che sale e scende', ru: '–ö–æ—Ç–æ—Ä–∞—è –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ —Å–ø–∞–¥–∞–µ—Ç' },
      { it: 'Che mi fa male, male', ru: '–ö–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –º–Ω–µ –±–æ–ª—å–Ω–æ, –±–æ–ª—å–Ω–æ' },
      { it: 'I tuoi occhi blu Klein', ru: '–¢–≤–æ–∏ —Å–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –ö–ª—è–π–Ω–∞' },
      { it: 'Dicono che', ru: '–ì–æ–≤–æ—Ä—è—Ç, —á—Ç–æ' },
      { it: 'Stanotte √® solo febbre', ru: '–≠—Ç–æ–π –Ω–æ—á—å—é ‚Äî –≤—Å–µ–≥–æ –ª–∏—à—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Che sale e scende', ru: '–ö–æ—Ç–æ—Ä–∞—è –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏ —É—Ö–æ–¥–∏—Ç' },
      { it: 'Tu prendi me', ru: '–¢—ã –±–µ—Ä—ë—à—å –º–µ–Ω—è' },
      { it: 'Come un enfant per strada', ru: '–ö–∞–∫ —Ä–µ–±—ë–Ω–∫–∞ –Ω–∞ —É–ª–∏—Ü–µ' },
      { it: 'In abito da gala', ru: '–í –≤–µ—á–µ—Ä–Ω–µ–º –ø–ª–∞—Ç—å–µ' },
      { it: 'Non ci amer√† la fama', ru: '–°–ª–∞–≤–∞ –Ω–∞—Å –Ω–µ –ø–æ–ª—é–±–∏—Ç' },
      { it: 'Non cambier√† la trama', ru: '–°—é–∂–µ—Ç –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è' },
      { it: 'Mille lune passeranno', ru: '–ü—Ä–æ–π–¥—É—Ç —Ç—ã—Å—è—á–∏ –ª—É–Ω' },
      { it: 'E una ci sar√† per sempre', ru: '–ò –æ–¥–Ω–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞' },
      { it: 'Per te che non vuoi scendere', ru: '–î–ª—è —Ç–µ–±—è, –∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Å–ø—É—Å–∫–∞—Ç—å—Å—è' },
      { it: 'Come la febbre', ru: '–ö–∞–∫ –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Ti sei preso una parte di me', ru: '–¢—ã –∑–∞–±—Ä–∞–ª —á–∞—Å—Ç—å –º–µ–Ω—è' },
      { it: 'Quella ancora pi√π in fondo dell‚Äôanima', ru: '–¢—É, —á—Ç–æ –µ—â—ë –≥–ª—É–±–∂–µ –≤ –¥—É—à–µ' },
      { it: 'Un sentimento', ru: '–ß—É–≤—Å—Ç–≤–æ' },
      { it: 'Che se si rompe taglia', ru: '–ö–æ—Ç–æ—Ä–æ–µ, –µ—Å–ª–∏ –ª–æ–º–∞–µ—Ç—Å—è, —Ä–µ–∂–µ—Ç' },
      { it: 'Come il vetro', ru: '–ö–∞–∫ —Å—Ç–µ–∫–ª–æ' },
      { it: 'Corro, corro come dentro un bosco', ru: '–Ø –±–µ–≥—É, –±–µ–≥—É, –∫–∞–∫ –ø–æ –ª–µ—Å—É' },
      { it: 'Dentro questo inferno √® pi√π difficile', ru: '–í —ç—Ç–æ–º –∞–¥—É –≤—Å—ë —Å–ª–æ–∂–Ω–µ–µ' },
      { it: 'Questo amore dimmi quanto costa', ru: '–°–∫–∞–∂–∏, —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç —ç—Ç–∞ –ª—é–±–æ–≤—å' },
      { it: 'Ti senti un‚Äôombra qua vicino a me', ru: '–¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–±—è —Ç–µ–Ω—å—é —Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π' },
      { it: 'Non ascolti quando grido', ru: '–¢—ã –Ω–µ —Å–ª—ã—à–∏—à—å, –∫–æ–≥–¥–∞ —è –∫—Ä–∏—á—É' },
      { it: 'E nemmeno se taccio', ru: '–î–∞–∂–µ –∫–æ–≥–¥–∞ —è –º–æ–ª—á—É' },
      { it: 'Non ascolti quando grido', ru: '–¢—ã –Ω–µ —Å–ª—ã—à–∏—à—å, –∫–æ–≥–¥–∞ —è –∫—Ä–∏—á—É' },
      { it: 'Non dire je t‚Äôaime', ru: '–ù–µ –≥–æ–≤–æ—Ä–∏ ¬´je t‚Äôaime¬ª' },
      { it: 'Dimmelo se', ru: '–°–∫–∞–∂–∏ –º–Ω–µ, –µ—Å–ª–∏' },
      { it: 'Ci√≤ che provi √® solo febbre', ru: '–¢–æ, —á—Ç–æ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å ‚Äî –≤—Å–µ–≥–æ –ª–∏—à—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Che sale e scende', ru: '–ö–æ—Ç–æ—Ä–∞—è –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ —Å–ø–∞–¥–∞–µ—Ç' },
      { it: 'Che mi fa male, male', ru: '–ö–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –º–Ω–µ –±–æ–ª—å–Ω–æ, –±–æ–ª—å–Ω–æ' },
      { it: 'I tuoi occhi blu Klein', ru: '–¢–≤–æ–∏ —Å–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –ö–ª—è–π–Ω–∞' },
      { it: 'Dicono che', ru: '–ì–æ–≤–æ—Ä—è—Ç, —á—Ç–æ' },
      { it: 'Stanotte √® solo febbre', ru: '–≠—Ç–æ–π –Ω–æ—á—å—é ‚Äî –≤—Å–µ–≥–æ –ª–∏—à—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Che sale e scende', ru: '–ö–æ—Ç–æ—Ä–∞—è –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏ —É—Ö–æ–¥–∏—Ç' },
      { it: 'Tu prendi me', ru: '–¢—ã –±–µ—Ä—ë—à—å –º–µ–Ω—è' },
      { it: 'Come un enfant per strada', ru: '–ö–∞–∫ —Ä–µ–±—ë–Ω–∫–∞ –Ω–∞ —É–ª–∏—Ü–µ' },
      { it: 'In abito da gala', ru: '–í –≤–µ—á–µ—Ä–Ω–µ–º –ø–ª–∞—Ç—å–µ' },
      { it: 'Non ci amer√† la fama', ru: '–°–ª–∞–≤–∞ –Ω–∞—Å –Ω–µ –ø–æ–ª—é–±–∏—Ç' },
      { it: 'Non cambier√† la trama', ru: '–°—é–∂–µ—Ç –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è' },
      { it: 'Mille lune passeranno', ru: '–ü—Ä–æ–π–¥—É—Ç —Ç—ã—Å—è—á–∏ –ª—É–Ω' },
      { it: 'E una ci sar√† per sempre', ru: '–ò –æ–¥–Ω–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞' },
      { it: 'Per te che non vuoi scendere‚Ä¶', ru: '–î–ª—è —Ç–µ–±—è, –∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Å–ø—É—Å–∫–∞—Ç—å—Å—è‚Ä¶' },
      { it: 'Non dire je t‚Äôaime', ru: '–ù–µ –≥–æ–≤–æ—Ä–∏ ¬´je t‚Äôaime¬ª' },
      { it: 'Dimmelo se', ru: '–°–∫–∞–∂–∏ –º–Ω–µ, –µ—Å–ª–∏' },
      { it: 'Ci√≤ che provi √® solo febbre', ru: '–¢–æ, —á—Ç–æ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å ‚Äî –≤—Å–µ–≥–æ –ª–∏—à—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Che sale e scende', ru: '–ö–æ—Ç–æ—Ä–∞—è –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ —Å–ø–∞–¥–∞–µ—Ç' },
      { it: 'Che mi fa male, male', ru: '–ö–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –º–Ω–µ –±–æ–ª—å–Ω–æ, –±–æ–ª—å–Ω–æ' },
      { it: 'I tuoi occhi blu Klein', ru: '–¢–≤–æ–∏ —Å–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –ö–ª—è–π–Ω–∞' },
      { it: 'Dicono che', ru: '–ì–æ–≤–æ—Ä—è—Ç, —á—Ç–æ' },
      { it: 'Stanotte √® solo febbre', ru: '–≠—Ç–æ–π –Ω–æ—á—å—é ‚Äî –≤—Å–µ–≥–æ –ª–∏—à—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Che poi ti prende‚Ä¶', ru: '–ö–æ—Ç–æ—Ä–∞—è –ø–æ—Ç–æ–º –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–±—è‚Ä¶' },
      { it: 'Come la febbre', ru: '–ö–∞–∫ –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' },
      { it: 'Come un enfant per strada', ru: '–ö–∞–∫ —Ä–µ–±—ë–Ω–æ–∫ –Ω–∞ —É–ª–∏—Ü–µ' },
      { it: 'In abito da gala', ru: '–í –≤–µ—á–µ—Ä–Ω–µ–º –ø–ª–∞—Ç—å–µ' },
      { it: 'Non ci amer√† la fama', ru: '–°–ª–∞–≤–∞ –Ω–∞—Å –Ω–µ –ø–æ–ª—é–±–∏—Ç' },
      { it: 'Non cambier√† la trama', ru: '–°—é–∂–µ—Ç –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è' },
      { it: 'Mille lune passeranno', ru: '–ü—Ä–æ–π–¥—É—Ç —Ç—ã—Å—è—á–∏ –ª—É–Ω' },
      { it: 'E una ci sar√† per sempre', ru: '–ò –æ–¥–Ω–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞' },
      { it: 'Per te che non vuoi scendere', ru: '–î–ª—è —Ç–µ–±—è, –∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Å–ø—É—Å–∫–∞—Ç—å—Å—è' },
      { it: 'Come la febbre', ru: '–ö–∞–∫ –ª–∏—Ö–æ—Ä–∞–¥–∫–∞' }
  ];


  const YADISK_PUBLIC_LINK = 'https://disk.yandex.ru/i/qi3_JYRI_IBLeg';

  function markNeedDownload(need) {
    const btn = document.getElementById("downloadBtn");
    const hint = document.getElementById("downloadHint");
    if (!btn || !hint) return;
    if (need) {
      btn.classList.add("highlight");
      hint.classList.add("warnText");
      hint.textContent = "–§–∞–π–ª –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å —Å –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–∞ (–∫–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—É –î–∏—Å–∫–∞)";
    } else {
      btn.classList.remove("highlight");
      hint.classList.remove("warnText");
      hint.textContent = "–§–∞–π–ª –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å —Å –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–∞";
    }
  }

  async function getDirectYadiskHref(publicLink) {
    const api = "https://cloud-api.yandex.net/v1/disk/public/resources/download?public_key=" + encodeURIComponent(publicLink);
    const res = await fetch(api, { method: "GET" });
    if (!res.ok) throw new Error("Yandex API error: " + res.status);
    const data = await res.json();
    if (!data || !data.href) throw new Error("No href in response");
    return data.href;
  }

  function startDownload() {
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –î–∏—Å–∫–∞ (download=1).
    // –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–±–∏–ª—å–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –Ω–µ –ª—é–±—è—Ç location.href –∏–∑ file://, –ø–æ—ç—Ç–æ–º—É –∫–ª–∏–∫–∞–µ–º –ø–æ <a>.
    const u = new URL(YADISK_PUBLIC_LINK);
    if (!u.searchParams.has("download")) u.searchParams.set("download", "1");
    const url = u.toString();

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –º—ã —Ä–µ–∞–ª—å–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–π—Ç–∏
    const hint = document.getElementById("downloadHint");
    if (hint) hint.textContent = "–û—Ç–∫—Ä—ã–≤–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–∞‚Ä¶";

    const a = document.createElement("a");
    a.href = url;
    a.target = "_self";
    a.rel = "noopener";
    a.style.display = "none";
    document.body.appendChild(a);
    a.click();
    a.remove();

    // –§–æ–ª–±—ç–∫ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∫–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
    setTimeout(() => {
      try { location.assign(url); } catch {}
    }, 50);
  }

  }



  const vid = document.getElementById("vid");
  const nowEl = document.getElementById("now");
  const fileLabel = document.getElementById("fileLabel");
  const filePick = document.getElementById("filePick");

  let uiTimer = null;
  let segTimer = null;

  function startTicker() {
    if (uiTimer) clearInterval(uiTimer);
    uiTimer = setInterval(() => {
      nowEl.textContent = (vid.currentTime || 0).toFixed(2);
    }, 120);
  }
  startTicker();

  function stopSegmentPlayback() {
    if (segTimer) clearInterval(segTimer);
    segTimer = null;
  }

  function playSegment(start, end) {
    const s = Number(start), e = Number(end);
    if (!Number.isFinite(s) || !Number.isFinite(e) || e <= s) {
      alert("–ü—Ä–æ–≤–µ—Ä—å —Ç–∞–π–º–∫–æ–¥—ã: start –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < end (–∏ –æ–±–∞ —á–∏—Å–ª–∞).");
      return;
    }
    stopSegmentPlayback();

    vid.currentTime = Math.max(0, s);
    const playPromise = vid.play();
    if (playPromise && typeof playPromise.catch === "function") {
      playPromise.catch(() => {});
    }

    segTimer = setInterval(() => {
      if ((vid.currentTime || 0) >= e - 0.03) {
        vid.pause();
        stopSegmentPlayback();
      }
    }, 40);
  }

  document.getElementById("stop").onclick = () => {
    vid.pause();
    stopSegmentPlayback();
  };


  // –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å"
  const downloadBtn = document.getElementById("downloadBtn");
  if (downloadBtn) downloadBtn.onclick = startDownload;

  // –ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç: –µ—Å–ª–∏ febbre.mp4 —Ä—è–¥–æ–º –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∏–º –∫–Ω–æ–ø–∫—É "–°–∫–∞—á–∞—Ç—å"
  (function autoDetectDefaultFile() {
    if (filePick && filePick.files && filePick.files.length) return;

    const onMeta = () => { markNeedDownload(false); cleanup(); };
    const onErr  = () => { markNeedDownload(true); cleanup(); };

    function cleanup(){
      vid.removeEventListener("loadedmetadata", onMeta);
      vid.removeEventListener("error", onErr);
    }

    vid.addEventListener("loadedmetadata", onMeta);
    vid.addEventListener("error", onErr);

    try { vid.load(); } catch {}
  })();

  function storageKey() {
    const name = (fileLabel.dataset.fileKey || "febbre.mp4");
    return `febbre_segments_local_${name}`;
  }

  function loadSegments() {
    try { return JSON.parse(localStorage.getItem(storageKey()) || "[]"); }
    catch { return []; }
  }
  function saveSegments(arr) {
    localStorage.setItem(storageKey(), JSON.stringify(arr));
  }

  let segments = loadSegments();
  if (!Array.isArray(segments)) segments = [];
  for (let i=0; i<LINES.length; i++) {
    if (!segments[i]) segments[i] = { start: null, end: null, learned: false };
    if (typeof segments[i].learned !== "boolean") segments[i].learned = false;
  }

  const rowsEl = document.getElementById("rows");
  let showLearned = true;

  function fmt(v) {
    if (v === null || v === undefined || v === "") return "";
    const n = Number(v);
    return Number.isFinite(n) ? n.toFixed(2) : "";
  }

  function renderRows() {
    rowsEl.innerHTML = "";

    LINES.forEach((line, i) => {
      const seg = segments[i];
      if (!showLearned && seg.learned) return;

      const row = document.createElement("div");
      row.className = "row";
      if (seg.learned) row.classList.add("muted");

      row.innerHTML = `
        <div class="it">${escapeHtml(line.it)}</div>
        <div class="ru">${escapeHtml(line.ru)}</div>

        <div class="controls">
          <button class="warn" data-act="play">‚ñ∂Ô∏è –§—Ä–∞–≥–º–µ–Ω—Ç</button>
          <button class="ghost" data-act="toggleRu">–ü–µ—Ä–µ–≤–æ–¥</button>

          <span class="mini">start</span>
          <input type="number" step="0.01" inputmode="decimal" data-field="start" value="${fmt(seg.start)}" />
          <button class="ghost" data-act="setStart">‚è± start=—Ç–µ–∫—É—â–µ–µ</button>

          <span class="mini">end</span>
          <input type="number" step="0.01" inputmode="decimal" data-field="end" value="${fmt(seg.end)}" />
          <button class="ghost" data-act="setEnd">‚è± end=—Ç–µ–∫—É—â–µ–µ</button>

          <button class="good" data-act="learned">${seg.learned ? "–í–µ—Ä–Ω—É—Ç—å –≤ –ø–æ–≤—Ç–æ—Ä" : "–í—ã—É—á–µ–Ω–æ"}</button>
        </div>
      `;

      const ruEl = row.querySelector(".ru");
      const startInput = row.querySelector('input[data-field="start"]');
      const endInput = row.querySelector('input[data-field="end"]');

      row.querySelector('[data-act="toggleRu"]').onclick = () => {
        ruEl.style.display = (ruEl.style.display === "block") ? "none" : "block";
      };

      row.querySelector('[data-act="setStart"]').onclick = () => {
        const t = vid.currentTime || 0;
        startInput.value = t.toFixed(2);
        segments[i].start = Number(startInput.value);
        saveSegments(segments);
      };

      row.querySelector('[data-act="setEnd"]').onclick = () => {
        const t = vid.currentTime || 0;
        endInput.value = t.toFixed(2);
        segments[i].end = Number(endInput.value);
        saveSegments(segments);
      };

      row.querySelector('[data-act="play"]').onclick = () => {
        const s = Number(startInput.value);
        const e = Number(endInput.value);
        segments[i].start = Number.isFinite(s) ? s : null;
        segments[i].end = Number.isFinite(e) ? e : null;
        saveSegments(segments);
        playSegment(segments[i].start, segments[i].end);
      };

      row.querySelector('[data-act="learned"]').onclick = () => {
        segments[i].learned = !segments[i].learned;
        saveSegments(segments);
        renderRows();
      };

      startInput.addEventListener("change", () => {
        const v = Number(startInput.value);
        segments[i].start = Number.isFinite(v) ? v : null;
        saveSegments(segments);
      });

      endInput.addEventListener("change", () => {
        const v = Number(endInput.value);
        segments[i].end = Number.isFinite(v) ? v : null;
        saveSegments(segments);
      });

      rowsEl.appendChild(row);
    });
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  renderRows();

  filePick.addEventListener("change", () => {
    const f = filePick.files && filePick.files[0];
    if (!f) return;

    fileLabel.textContent = f.name;
    fileLabel.dataset.fileKey = f.name;

    segments = loadSegments();
    if (!Array.isArray(segments)) segments = [];
    for (let i=0; i<LINES.length; i++) {
      if (!segments[i]) segments[i] = { start: null, end: null, learned: false };
      if (typeof segments[i].learned !== "boolean") segments[i].learned = false;
    }
    renderRows();

    const url = URL.createObjectURL(f);
    vid.src = url;
    vid.load();
  });

  document.getElementById("useDefault").onclick = () => {
    fileLabel.textContent = "febbre.mp4";
    fileLabel.dataset.fileKey = "febbre.mp4";

    segments = loadSegments();
    if (!Array.isArray(segments)) segments = [];
    for (let i=0; i<LINES.length; i++) {
      if (!segments[i]) segments[i] = { start: null, end: null, learned: false };
      if (typeof segments[i].learned !== "boolean") segments[i].learned = false;
    }
    renderRows();

    vid.src = "febbre.mp4";
    vid.load();
  };

  document.getElementById("saveAll").onclick = () => {
    saveSegments(segments);
    alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ");
  };

  let ruShownAll = false;
  document.getElementById("toggleRuAll").onclick = () => {
    ruShownAll = !ruShownAll;
    document.querySelectorAll(".ru").forEach(el => el.style.display = ruShownAll ? "block" : "none");
  };

  document.getElementById("toggleLearned").onclick = () => {
    showLearned = !showLearned;
    document.getElementById("toggleLearned").textContent = showLearned ? "–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –≤—ã—É—á–µ–Ω–Ω—ã–µ" : "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—ã—É—á–µ–Ω–Ω—ã–µ: –ù–ï–¢";
    renderRows();
  };

  document.getElementById("resetTimes").onclick = () => {
    if (!confirm("–°–±—Ä–æ—Å–∏—Ç—å start/end –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫?")) return;
    segments = segments.map(s => ({...s, start: null, end: null}));
    saveSegments(segments);
    renderRows();
  };

  document.getElementById("copyNow").onclick = async () => {
    const t = (vid.currentTime || 0).toFixed(2);
    try {
      await navigator.clipboard.writeText(t);
      alert(`–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ${t}s`);
    } catch {
      prompt("–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é:", t);
    }
  };

  const exportBox = document.getElementById("exportBox");
  const importBox = document.getElementById("importBox");

  document.getElementById("exportBtn").onclick = () => {
    const payload = {
      file: fileLabel.dataset.fileKey || "febbre.mp4",
      lines: LINES.map(x => x.it),
      segments
    };
    exportBox.value = JSON.stringify(payload, null, 2);
  };

  document.getElementById("copyExport").onclick = async () => {
    if (!exportBox.value.trim()) {
      alert("–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ ¬´–≠–∫—Å–ø–æ—Ä—Ç¬ª.");
      return;
    }
    try {
      await navigator.clipboard.writeText(exportBox.value);
      alert("JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω ‚úÖ");
    } catch {
      prompt("–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é:", exportBox.value);
    }
  };

  document.getElementById("importBtn").onclick = () => {
    let obj;
    try { obj = JSON.parse(importBox.value); }
    catch {
      alert("–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å JSON.");
      return;
    }
    if (!obj || !Array.isArray(obj.segments)) {
      alert("–í JSON –Ω–µ—Ç –º–∞—Å—Å–∏–≤–∞ segments.");
      return;
    }
    segments = obj.segments.slice(0, LINES.length);
    for (let i=0; i<LINES.length; i++) {
      if (!segments[i]) segments[i] = { start: null, end: null, learned: false };
      if (typeof segments[i].learned !== "boolean") segments[i].learned = false;
    }
    saveSegments(segments);
    renderRows();
    alert("–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ");
  };
</script>
</body>
</html>
